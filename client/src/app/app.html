<!-- Fixed Toggle Controls -->
<control-toggle
  [showControls]="showControls()"
  (showControlsChange)="showControls.set($event)"
></control-toggle>

<!-- Fixed Theme Toggle -->
<div class="fixed top-0 left-0 z-50 m-2">
  <app-theme-toggle></app-theme-toggle>
</div>

<!-- Main Grid Layout -->
<div
  class="grid min-h-screen gap-4 p-1 bg-gray-100 dark:bg-gray-900 grid-cols-1 md:grid-cols-4"
>
  <!-- Sidebar -->
  <div *ngIf="showControls()" class="md:col-span-1">
    <div class="flex justify-between items-center mb-2">
      <!-- SVG logo animation -->
      <svg viewBox="21.76 23.56 298.02 80.78" class="scale-[65%]">
        <path
          d="M118.275 41.673c0 1.801-1.412 3.214-3.251 3.214s-3.274-1.413-3.274-3.214c0-1.802 1.45-3.177 3.274-3.177s3.251 1.413 3.251 3.177m-5.718 0c0 1.412 1.047 2.541 2.482 2.541 1.435 0 2.422-1.121 2.422-2.519 0-1.398-1.024-2.556-2.445-2.556-1.42 0-2.459 1.144-2.459 2.541zm1.959 1.667h-.733v-3.177c.292-.06.695-.097 1.219-.097.598 0 .874.097 1.106.231.172.135.306.39.306.696 0 .35-.269.62-.658.74v.037c.307.12.486.351.583.777.098.486.157.68.232.793h-.792c-.097-.12-.157-.404-.254-.778-.06-.351-.254-.5-.658-.5h-.351zm.022-1.802h.351c.404 0 .74-.134.74-.463 0-.292-.216-.486-.68-.486-.194 0-.329.022-.403.037v.912z"
          class="fill-black dark:fill-yellow-400"
        />
        <path
          d="M67.281 43.708 25.925 56.507l-.046 7.063h7.02l.086 23.049 68.263-.312.104-22.442 5.507-.208.103-7.17-11.948-3.636-.104-9.143H81.195v4.26z"
          class="fill-black dark:fill-yellow-400"
          transform="matrix(1.17494 0 0 1.17494 -4.71 -13.912)"
        />
        <path
          d="M67.268 47.389 29.863 58.556l-.14 2.088h6.606L36.31 83.71h61.717V60.644h6.234v-2.182l-12.053-3.533-.104-7.896-7.584.104-.104 5.195z"
          class="fill-yellow-400 dark:fill-black"
          transform="matrix(1.17494 0 0 1.17494 -4.71 -13.912)"
        />
        <g aria-label="md">
          <path
            d="M-61.455 82.408c-1.013 0-1.96.248-2.842.74-.882.493-1.15.725-1.767 1.616v-2.037h-6.774v2.244h1.502v9.234h-1.502v2.287h8.205v-2.199h-1.431v-7.12c.07-.427.568-1.22 1.177-1.568.62-.348 1.22-.521 1.801-.521.6 0 1.045.182 1.336.547.3.365.451.914.451 1.644v7.08h-1.73v2.09h8.054v-2.09h-1.666v-7.181c.038-.507.6-1.22 1.21-1.569.618-.348 1.219-.521 1.8-.521.6 0 .844.152 1.145.518.3.365.17.943.17 1.673v6.93h-1.258v2.219h8.197v-2.219h-1.332v-3.367h-2.645V88.15h2.645v-1.728c.007-1.342-.88-2.423-1.555-3.09-.675-.667-2.276-.924-3.636-.924a5.819 5.819 0 0 0-2.858.74c-.882.493-1.985 1.279-2.318 1.727h-.254c-.197-.985-.772-1.234-1.438-1.727-.666-.492-1.561-.74-2.687-.74zM-34.99 76.429l.064 2.431.042 3.867.054 1.414c-.656-.578-.826-1.01-1.586-1.3-.76-.288-1.778-.55-2.64-.55-1.99 0-3.315.697-4.506 2.09-.848.985-1.283 2.273-1.467 3.77h3.193v2.687h-3.281c.114 1.772.63 3.21 1.55 4.31 1.051 1.257 2.203 1.885 3.985 1.885 1.163 0 2.18.077 3.053-.416.872-.492 1.003-.612 1.584-1.597l.06 1.695h6.8v-2.238h-1.17V78.238c-.782-.165-3.417-1.103-5.736-1.809zm-.777 8.917c.355.171.606.354.734.681v7.137c-.007.666-.178.894-.779 1.217-.767.264-1.278.334-2.227.119-.95-.215-1.187-.221-1.513-1.36-.326-1.139-.26-1.787-.26-3.299 0-1.494.052-3.096.612-3.751.53-.609 1.271-.969 2.013-.979.527.026.96.11 1.42.235z"
            transform="translate(143.054 -55.983) scale(1.36726)"
            class="fill-black dark:fill-yellow-400"
          />
        </g>
        <path
          d="M67.268 47.389 29.863 58.556l-.14 2.088h6.606L36.31 83.71h61.717V60.644h6.234v-2.182l-12.053-3.533-.104-7.896-7.584.104-.104 5.195z"
          class="fill-none stroke-black stroke-[0.2646] stroke-linecap-butt stroke-linejoin-miter stroke-opacity-100"
          transform="matrix(1.17494 0 0 1.17494 -4.71 -13.912)"
        />
        <g aria-label="SUNBEAM">
          <path
            d="M35.106 42.687h-2.02v-.62q0-.434-.078-.553-.077-.12-.258-.12-.197 0-.3.161-.098.16-.098.486 0 .418.113.63.109.212.615.512 1.453.863 1.83 1.416.377.553.377 1.783 0 .894-.212 1.317-.207.424-.806.714-.6.284-1.395.284-.874 0-1.494-.33-.615-.332-.806-.843-.191-.512-.191-1.452v-.548h2.02v1.018q0 .47.083.605.088.134.305.134t.32-.17q.109-.171.109-.507 0-.74-.202-.966-.206-.228-1.018-.76-.81-.538-1.074-.78-.264-.243-.44-.672-.17-.43-.17-1.096 0-.96.243-1.405.248-.445.795-.693.548-.253 1.323-.253.848 0 1.442.274.6.274.79.692.197.414.197 1.411z"
            class="fill-gray-500 dark:fill-yellow-400 stroke-0"
            transform="matrix(4.5665 0 0 4.25017 -2.444 -122.384)"
          />
          <path
            d="M130.715 282.05v5.909h9.54v-5.908zm12.283 0v5.909h9.543v-5.908zm-12.283 10.208v11.506c0 4.14.075 6.86.226 8.16.152 1.284.642 2.508 1.473 3.672.831 1.163 2.085 2.106 3.762 2.832 1.677.725 3.612 1.088 5.803 1.088 1.979 0 3.693-.302 5.144-.907 1.466-.62 2.646-1.518 3.537-2.697.892-1.194 1.428-2.349 1.61-3.467.18-1.133.271-3.09.271-5.87v-14.317h-9.543v16.832c0 1.828-.09 2.991-.271 3.49-.167.484-.552.727-1.157.727-.529 0-.883-.22-1.064-.659-.166-.453-.25-1.48-.25-3.082v-17.308zM156.236 282.05v5.909h9.889l-1.912-5.908zm13.327 0v5.909h7.978v-5.908zm-13.327 10.208v26.488h7.977v-16.682l4.965 16.682h8.363v-26.488h-7.978v6.316l-2.045-6.316zM181.371 282.05v5.909h21.068c-.233-.945-.552-1.734-.964-2.35-.952-1.435-2.206-2.387-3.762-2.855-1.541-.469-3.815-.703-6.822-.703zm0 10.208v26.488h11.04c3.837 0 6.375-.22 7.614-.658 1.24-.438 2.139-1.254 2.698-2.447.574-1.194.861-3.03.861-5.508v-3.4c0-2.388-.394-4.155-1.18-5.303-.785-1.164-2.28-1.996-4.486-2.494 1.98-.454 3.3-1.104 3.965-1.95.68-.846 1.021-2.34 1.021-4.486 0-.087-.009-.157-.01-.242h-8.861c-.018 1.895-.14 3.094-.377 3.527-.257.453-.854.68-1.791.68-.227 0-.543.008-.951.023v-4.23zm9.543 9.941c1.42.046 2.297.236 2.629.569.332.332.498 1.284.498 2.855v3.422c0 1.48-.189 2.41-.566 2.787-.363.378-1.216.59-2.56.635zM207.006 282.05v5.909h15.912v-5.908zm0 10.208v26.488h16.545v-7.344h-7.002v-8.068h5.96v-6.982h-5.96v-4.094zM228.969 282.05l-.781 5.909h15.462l-.879-5.908zm-1.35 10.208-3.5 26.488H234l.566-6.596h3.424l.475 6.596h9.77l-3.944-26.488h-7.852c.427 5.175.852 9.725 1.278 13.387h-3.264c.215-2.892.765-7.515 1.555-13.387zM249.865 282.05v5.909h13.242a274.208 274.208 0 0 0-.888-5.908zm17 0-.75 5.909h13.194v-5.908zm-17 10.208v26.488h8.342V294.54l3.514 24.207h5.916l3.33-24.773v24.773h8.342v-26.488h-13.74l-.88 6.928-.974-6.928z"
            class="fill-gray-500 dark:fill-yellow-400 stroke-0"
            transform="matrix(1.04115 0 0 .96902 25.575 -225.033)"
          />
        </g>

        <g
          id="beams1"
          [ngClass]="
            (sunVisible()
              ? 'opacity-100 translate-y-0'
              : 'opacity-0 translate-y-1') +
            ' relative transform transition-all duration-800 ease-out'
          "
        >
          <g transform="matrix(3.24736 0 0 5.6431 101.757 -332.567)">
            <path
              d="m12.618 67.128.45-.742.424-.757.417.761.445.746-.868-.02z"
              class="fill-yellow-400 dark:fill-yellow-400"
            />
          </g>
          <g transform="matrix(2.34374 .66528 -1.0231 3.1223 189.023 -171.465)">
            <path
              d="m12.618 67.128.45-.742.424-.757.417.761.445.746-.868-.02z"
              class="fill-yellow-400 dark:fill-yellow-400"
            />
          </g>
          <g
            transform="matrix(1.74783 1.59835 -2.45805 2.32843 298.603 -127.91)"
          >
            <path
              d="m12.618 67.128.45-.742.424-.757.417.761.445.746-.868-.02z"
              class="fill-yellow-400 dark:fill-yellow-400"
            />
          </g>
        </g>

        <g
          id="beams2"
          [ngClass]="
            (sunVisible()
              ? 'opacity-100 translate-x-0'
              : 'opacity-0 translate-x-1') +
            ' relative transform transition-all duration-800 ease-out'
          "
        >
          <g transform="matrix(1.0798 -2.0472 3.14831 1.4385 -90.207 -16.784)">
            <path
              d="m12.618 67.128.45-.742.424-.757.417.761.445.746-.868-.02z"
              class="fill-yellow-400 dark:fill-yellow-400"
            />
          </g>
          <g
            transform="matrix(2.1483 -1.09687 1.68683 2.86193 -2.875 -129.438)"
          >
            <path
              d="m12.618 67.128.45-.742.424-.757.417.761.445.746-.868-.02z"
              class="fill-yellow-400 dark:fill-yellow-400"
            />
          </g>
          <g transform="matrix(0 -3.24736 5.6431 0 -244.068 101.417)">
            <path
              d="m12.618 67.128.45-.742.424-.757.417.761.445.746-.868-.02z"
              class="fill-yellow-400 dark:fill-yellow-400"
            />
          </g>
        </g>
      </svg>
    </div>

    <h1 class="text-xl font-bold mb-2 text-gray-800 dark:text-white">
      Controls
    </h1>
    <!-- SelectBox -->
    <div class="mb-4">
      <app-select-box
        [label]="'Machines'"
        [options]="machines()"
        (selectionChange)="selectMachine($event)"
      ></app-select-box>
    </div>

    <!-- List -->
    <app-list
      [title]="'Operators'"
      [items]="selectedOperatorGroup()"
      [displayFn]="operatorDisplay"
      (itemClick)="selectOperator($event)"
    ></app-list>

    <!-- ButtonPanel wrapper -->
    <div class="relative p-4">
      <app-button-panel
        (onStart)="handleStart()"
        (onStop)="handleStop()"
      ></app-button-panel>
    </div>
  </div>

  <!-- Main Content Area -->
  <div
    [ngClass]="
      (showControls() ? 'md:col-span-3' : 'md:col-span-4') +
      ' flex flex-col h-full bg-white dark:bg-gray-800 rounded shadow-md p-10 gap-10'
    "
  >
    <!-- StatusBanner -->
    <app-status-banner
      [operator]="selectedOperator()"
      [machine]="selectedMachine()"
    ></app-status-banner>

    <div class="flex-grow">
      <!-- ScoreCard -->
      <app-score-card
        [averageRate]="averageRate()"
        [targetRate]="targetRate()"
        [currentCount]="totalCount()"
        [percentage]="percentage()"
        [averageLabel]="'Average Rate (hourly)'"
        [targetLabel]="'Target Rate (hourly)'"
        [currentLabel]="'Current Count'"
        [percentageLabel]="'percentage'"
        [avgThreshold]="avgThreshold()"
        [countThreshold]="countThreshold()"
        [percThreshold]="percThreshold()"
      ></app-score-card>
    </div>

    <div class="flex-shrink-0 max-h-30">
      <!-- DowntimeCard -->
      <downtime-card
        [currentDowntime]="currentDowntime()"
        [totalDowntime]="totalDowntime()"
        [currentThreshold]="{ low: 30, mid: 60 }"
        [totalThreshold]="{ low: 180, mid: 300 }"
      ></downtime-card>
    </div>
  </div>
</div>
<router-outlet></router-outlet>
